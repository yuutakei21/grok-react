FROM node:18-alpine AS builder
WORKDIR /app
COPY package.json yarn.lock ./
RUN apk add --no-cache yarn && yarn install --frozen-lockfile
COPY . .
COPY .env .
ARG VERSION=$(node -p "require('./package.json').version")
ARG BUILD_TIME=$(date -u +"%Y-%m-%dT%H:%M:%SZ")
ENV REACT_APP_VERSION=$VERSION
ENV REACT_APP_BUILD_TIME=$BUILD_TIME
RUN yarn build
FROM nginx:alpine
COPY --from=builder /app/dist /usr/share/nginx/html
EXPOSE 80
CMD ["nginx", "-g", "daemon off;"]